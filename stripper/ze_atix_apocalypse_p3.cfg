;Unlock the two doors in the apartment on the south-side since they have rooms behind it, not sure why they were locked in the first place.
;Credits for the discovery: GXP-10
modify:
{
	match:
	{
		"hammerid" "23189"
		"classname" "prop_door_rotating"
	}
	replace:
	{
		"spawnflags" "8192"
	}
}

modify:
{
	match:
	{
		"hammerid" "23190"
		"classname" "prop_door_rotating"
	}
	replace:
	{
		"spawnflags" "8192"
	}
}

;Adding a zm push for the train route since zombies could camp either of the entrances to the subway
;making it nearly impossible to keep humans alive during that route.
add:
{
	"classname" "trigger_push"
	"targetname" "TrainPush"
	"StartDisabled" "1"
	"speed" "600"
	"spawnflags" "1"
	"pushdir" "0 180 0"
	"origin" "3115.5 -1121.5 218"
	"filtername" "Zombies"
	"alternateticksfix" "0"
}

add:
{
	"classname" "trigger_push"
	"targetname" "TrainPush2"
	"StartDisabled" "1"
	"speed" "600"
	"spawnflags" "1"
	"pushdir" "0 180 0"
	"origin" "-250 -144 -263.5"
	"filtername" "Zombies"
	"alternateticksfix" "0"
}

modify:
{
	match:
	{
		"targetname" "Auto"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnSpawn" "TrainPush,AddOutput,solid 2,0.5,1"
		"OnSpawn" "TrainPush,AddOutput,mins -111.5 -1115.5 -145,1,1"
		"OnSpawn" "TrainPush,AddOutput,maxs 111.5 1115.5 145,1,1"
		"OnSpawn" "TrainPush2,AddOutput,solid 2,0.5,1"
		"OnSpawn" "TrainPush2,AddOutput,mins -22 -81 -69.5,1,1"
		"OnSpawn" "TrainPush2,AddOutput,maxs 22 81 69.5,1,1"
	}
}

modify:
{
	match:
	{
		"targetname" "trainstart"
		"classname" "logic_relay"
	}
	insert:
	{
		"OnTrigger" "TrainPush,Enable,,9.5,1"
		"OnTrigger" "TrainPush,Disable,,19.5,1"
		"OnTrigger" "TrainPush2,Enable,,9.5,1"
		"OnTrigger" "TrainPush2,Disable,,19.5,1"
	}
}

;Players purposely boosting zombies to secret that is not meant for normal play. Locks button.
modify:
{
	match:
	{
		"classname" "func_button"
		"origin" "-63.5 44.99 658.5"
	}
	insert:
	{
		"targetname" "MushroomSecret"
	}
	replace:
	{
		"spawnflags" "3073"
	}
}

;Doors close properly and do not stick players.
modify:
{
	match:
	{
		"classname" "func_door"
		"ignoredebris" "1"
		"forceclosed" "1"
	}
	replace:
	{
		"ignoredebris" "0"
	}
}

;Boat evac. is a bit easier.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Boat"
	}
	delete:
	{
		"OnTrigger" "Sewer_tapsFireUser119-1"
		"OnTrigger" "SewerPush*Kill26-1"
	}
	insert:
	{
		"OnTrigger" "Sewer_taps,FireUser1,,18,-1"
		"OnTrigger" "SewerPush*,Kill,,40,-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_push"
		"targetname" "SewerPush"
	}
	replace:
	{
		"speed" "1024"
	}
}

;player_speedmod replacements.
add:
{
	"classname" "logic_relay"
	"targetname" "Slowdown_Patch"
	"spawnflags" "2"
	"OnTrigger" "!activatorRunScriptCodeforeach(v,_ in {SetHealth=0}) { EntFireByHandle(self, v, (self.GetHealth() - 1).tostring(), 0.0, null, null); }0-1"
	"OnTrigger" "!activatorRunScriptCodeforeach(v,_ in {SetHealth=0}) { EntFireByHandle(self, v, (self.GetHealth() + 1).tostring(), 0.0, null, null); }0.1-1"
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"origin" "3159 34 569"
	}
	delete:
	{
		"OnHurtPlayer" "speedModifySpeed16-1"
		"OnHurtPlayer" "speedModifySpeed0.955.9-1"
		"OnHurtPlayer" "speedModifySpeed0.905.8-1"
		"OnHurtPlayer" "speedModifySpeed0.855.7-1"
		"OnHurtPlayer" "speedModifySpeed0.805.6-1"
		"OnHurtPlayer" "speedModifySpeed0.755.5-1"
		"OnHurtPlayer" "speedModifySpeed0.705.4-1"
		"OnHurtPlayer" "speedModifySpeed0.655.3-1"
		"OnHurtPlayer" "speedModifySpeed0.655.2-1"
		"OnHurtPlayer" "speedModifySpeed0.655.1-1"
		"OnHurtPlayer" "speedModifySpeed0.655-1"
		"OnHurtPlayer" "speedModifySpeed0.654.9-1"
		"OnHurtPlayer" "speedModifySpeed0.654.8-1"
		"OnHurtPlayer" "speedModifySpeed0.654.7-1"
		"OnHurtPlayer" "speedModifySpeed0.654.6-1"
		"OnHurtPlayer" "speedModifySpeed0.654.5-1"
		"OnHurtPlayer" "speedModifySpeed0.654.4-1"
		"OnHurtPlayer" "speedModifySpeed0.654.3-1"
		"OnHurtPlayer" "speedModifySpeed0.654.2-1"
		"OnHurtPlayer" "speedModifySpeed0.654.1-1"
		"OnHurtPlayer" "speedModifySpeed0.654-1"
		"OnHurtPlayer" "speedModifySpeed0.653.9-1"
		"OnHurtPlayer" "speedModifySpeed0.653.8-1"
		"OnHurtPlayer" "speedModifySpeed0.653.7-1"
		"OnHurtPlayer" "speedModifySpeed0.653.6-1"
		"OnHurtPlayer" "speedModifySpeed0.653.5-1"
		"OnHurtPlayer" "speedModifySpeed0.653.4-1"
		"OnHurtPlayer" "speedModifySpeed0.653.3-1"
		"OnHurtPlayer" "speedModifySpeed0.653.2-1"
		"OnHurtPlayer" "speedModifySpeed0.653.1-1"
		"OnHurtPlayer" "speedModifySpeed0.653-1"
		"OnHurtPlayer" "speedModifySpeed0.652.9-1"
		"OnHurtPlayer" "speedModifySpeed0.652.8-1"
		"OnHurtPlayer" "speedModifySpeed0.652.7-1"
		"OnHurtPlayer" "speedModifySpeed0.652.6-1"
		"OnHurtPlayer" "speedModifySpeed0.652.5-1"
		"OnHurtPlayer" "speedModifySpeed0.652.4-1"
		"OnHurtPlayer" "speedModifySpeed0.652.3-1"
		"OnHurtPlayer" "speedModifySpeed0.652.2-1"
		"OnHurtPlayer" "speedModifySpeed0.652.1-1"
		"OnHurtPlayer" "speedModifySpeed0.652-1"
		"OnHurtPlayer" "speedModifySpeed0.651.9-1"
		"OnHurtPlayer" "speedModifySpeed0.651.8-1"
		"OnHurtPlayer" "speedModifySpeed0.651.7-1"
		"OnHurtPlayer" "speedModifySpeed0.651.6-1"
		"OnHurtPlayer" "speedModifySpeed0.651.5-1"
		"OnHurtPlayer" "speedModifySpeed0.651.4-1"
		"OnHurtPlayer" "speedModifySpeed0.651.3-1"
		"OnHurtPlayer" "speedModifySpeed0.651.2-1"
		"OnHurtPlayer" "speedModifySpeed0.651.1-1"
		"OnHurtPlayer" "speedModifySpeed0.651-1"
		"OnHurtPlayer" "speedModifySpeed0.650.9-1"
		"OnHurtPlayer" "speedModifySpeed0.650.8-1"
		"OnHurtPlayer" "speedModifySpeed0.650.7-1"
		"OnHurtPlayer" "speedModifySpeed0.650.6-1"
		"OnHurtPlayer" "speedModifySpeed0.650.5-1"
		"OnHurtPlayer" "speedModifySpeed0.650.4-1"
		"OnHurtPlayer" "speedModifySpeed0.650.3-1"
		"OnHurtPlayer" "speedModifySpeed0.650.2-1"
		"OnHurtPlayer" "speedModifySpeed0.650.1-1"
		"OnHurtPlayer" "speedModifySpeed0.650-1"
	}
	insert:
	{
		"OnHurtPlayer" "Slowdown_Patch,Trigger,,0,-1"
		"OnHurtPlayer" "Slowdown_Patch,Trigger,,2,-1"
		"OnHurtPlayer" "Slowdown_Patch,Trigger,,4,-1"
		"OnHurtPlayer" "Slowdown_Patch,Trigger,,6,-1"
	}
}

;Train doors can not be abused.
modify:
{
	match:
	{
		"classname" "func_door"
		"targetname" "train_door_2"
	}
	replace:
	{
		"forceclosed" "1"
		"wait" "-1"
	}
}

;Appears to be a mistake. Not sure why or how this happened.
modify:
{
	match:
	{
		"classname" "func_button"
		"origin" "1188 -840.5 63"
	}
	delete:
	{
		"targetname" "truck_junk"
	}
}

;Post panorama players can spawn on the very first round wherever the point_camera/first spawn point is.
;Meaning they can get ahead (or stuck) where they shouldn't be.
filter:
{
	"classname" "point_viewcontrol"
}

;Reduced train escape time. Takes a looooong while.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "trainstart"
	}
	delete:
	{
		"OnTrigger" "train_security_door_3Unlock1201"
		"OnTrigger" "train_security_door_2Open1201"
		"OnTrigger" "train_door_2Open1101"
		"OnTrigger" "first_doorBreak1201"
		"OnTrigger" "trainOpen1201"
		"OnTrigger" "train_sound_leavePlaySound1201"
		"OnTrigger" "tdoor1Open125-1"
		"OnTrigger" "tdoor2Open125-1"
		"OnTrigger" "train_sound_leavePlaySound1241"
		"OnTrigger" "TrainSoundVolume101201"
	}
	insert:
	{
		"OnTrigger" "train_security_door_3,Unlock,,90,1"
		"OnTrigger" "train_security_door_2,Open,,90,1"
		"OnTrigger" "train_door_2,Open,,80,1"
		"OnTrigger" "first_door,Break,,90,1"
		"OnTrigger" "train,Open,,90,1"
		"OnTrigger" "train_sound_leave,PlaySound,,90,1"
		"OnTrigger" "tdoor1,Open,,95,-1"
		"OnTrigger" "tdoor2,Open,,95,-1"
		"OnTrigger" "train_sound_leave,PlaySound,,89,1"
		"OnTrigger" "TrainSound,Volume,10,90,1"
	}
}

;Random crash fix(?) - Removes "SF_TRACKTRAIN_UNBLOCKABLE_BY_PLAYER" flags
modify:
{
	match:
	{
		"classname" "func_tracktrain"
		"spawnflags" "643"
	}
	replace:
	{
		"spawnflags" "131"
	}
}

modify:
{
	match:
	{
		"classname" "func_tracktrain"
		"spawnflags" "899"
	}
	replace:
	{
		"spawnflags" "387"
	}
}

;More time for zombies having a chance on blackhawk helicopter path.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"origin" "352 1418 544"
	}
	delete:
	{
		"OnStartTouch" "!selfFireUser121"
		"OnStartTouch" "!selfKill41"
	}
	insert:
	{
		"OnStartTouch" "!selfFireUser191"
		"OnStartTouch" "!selfKill111"
	}
}

;Prevent players from being sneaky in spectate.
modify:
{
	match:
	{
		"classname" "logic_timer"
		"hammerid" "16998"
	}
	replace:
	{
		"RefireTime" "6"
	}
}

;Prevent delaying.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "startmusic"
	}
	insert:
	{
		"OnStartTouch" "hadoor,Break,,20,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_door"
		"targetname" "/lastdoor.*/"
	}
	replace:
	{
		"dmg" "999999"
		"forceclosed" "1"
	}
}

add:
{
	"model" "*97"
	"classname" "trigger_hurt"
	"origin" "492 -3730 -156"
	"targetname" "SewerHurtDelay"
	"StartDisabled" "1"
	"spawnflags" "1"
	"nodmgforce" "0"
	"damagetype" "256"
	"damagemodel" "1"
	"damage" "5"
	"damagecap" "25"
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Boat"
	}
	insert:
	{
		"OnTrigger" "SewerHurtDelay,Enable,,75,1"
	}
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "HelicopterWindowHelper"
	"spawnflags" "0"
	"solid" "6"
	"rendercolor" "255 255 255"
	"renderamt" "255"
	"renderfx" "0"
	"SetBodyGroup" "0"
	"rendermode" "0"
	"StartDisabled" "0"
	"RandomAnimation" "0"
	"pressuredelay" "0"
	"PerformanceMode" "0"
	"HoldAnimation" "0"
	"is_autoaim_target" "0"
	"ExplodeRadius" "0"
	"ExplodeDamage" "0"
	"disableshadows" "0"
	"disablereceiveshadows" "0"
	"body" "0"
	"model" "models/props_foliage/urban_balcony_planter01a.mdl"
	"skin" "2"
	"DisableBoneFollowers" "1"
	"angles" "0 270 0"
	"MinAnimTime" "5"
	"MaxAnimTime" "10"
	"fadescale" "1"
	"fademindist" "-1"
	"origin" "2916 -22 369"
}

;Reduced truck escape time.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "atixtruck"
	}
	delete:
	{
		"OnTrigger" "atix_truckSetSpeed1401201"
		"OnTrigger" "escape_glass_whBreak1101"
		"OnTrigger" "A45Open1201"
		"OnTrigger" "metal_doorBreak1201"
		"OnTrigger" "atix_truckStartForward1201"
		"OnTrigger" "freezombiesBreak1231"
		"OnTrigger" "truck_soundPlaySound1001"
		"OnTrigger" "truck_lightTurnOn1201"
		"OnTrigger" "truck_spotlightsLightOn1201"
		"OnTrigger" "truckwheels*Start1201"
	}
	insert:
	{
		"OnTrigger" "atix_truck,SetSpeed,140,90,1"
		"OnTrigger" "escape_glass_wh,Break,,80,1"
		"OnTrigger" "A45,Open,,90,1"
		"OnTrigger" "metal_door,Break,,90,1"
		"OnTrigger" "atix_truck,StartForward,,90,1"
		"OnTrigger" "freezombies,Break,,93,1"
		"OnTrigger" "truck_sound,PlaySound,,70,1"
		"OnTrigger" "truck_light,TurnOn,,90,1"
		"OnTrigger" "truck_spotlights,LightOn,,90,1"
		"OnTrigger" "truckwheels*,Start,,90,1"
	}
}

;Doors cannot be blocked.
modify:
{
	match:
	{
		"classname" "func_door_rotating"
		"targetname" "double_doors"
	}
	replace:
	{
		"dmg" "1"
		"forceclosed" "1"
	}
}

;More delay prevents...
add:
{
	"classname" "logic_timer"
	"targetname" "PreventDelay2"
	"spawnflags" "0"
	"StartDisabled" "1"
	"UseRandomTime" "1"
	"LowerRandomBound" "7"
	"UpperRandomBound" "9"
	"OnTimer" "prop_phys*RunScriptCodeforeach(a1,_ in {explosion_basic=0}) a <- a101"
	"OnTimer" "elevatorRunScriptCodeforeach(a1,_ in {explosion_basic=0}) a <- a101"
	"OnTimer" "prop_phys*RunScriptCodeb <- 'b'.tochar() + 'r'.tochar() + 'e'.tochar() + 'a'.tochar() + 'k'.tochar()01"
	"OnTimer" "prop_phys*RunScriptCodefunction c(){ DispatchParticleEffect(a, self.GetOrigin(), Vector(null));EntFireByHandle(self, b, b, 0.02, null, null); }01"
	"OnTimer" "elevatorRunScriptCodefunction c(){ DispatchParticleEffect(a, self.GetOrigin(), Vector(null));self.Destroy(); }01"
	"OnTimer" "prop_phys*RunScriptCodeif (RandomInt(0, 7) == 1) c();0.01-1"
	"OnTimer" "elevatorRunScriptCodeif (RandomInt(0, 2) == 1) c();0.01-1"
}

modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "lolwut"
	}
	insert:
	{
		"OnCase01" "PreventDelay2,Enable,,180,1"
		"OnCase02" "PreventDelay2,Enable,,180,1"
		"OnCase03" "PreventDelay2,Enable,,110,1"
		"OnCase04" "PreventDelay2,Enable,,110,1"
		"OnCase04" "PreventDelay2,LowerRandomBound,9,110,1"
		"OnCase04" "PreventDelay2,UpperRandomBound,13,110,1"
		"OnCase05" "PreventDelay2,Enable,,110,1"
	}
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "DelayOfficeClip"
	"disableflashlight" "1"
	"disablereceiveshadows" "1"
	"disableshadowdepth" "1"
	"disableshadows" "1"
	"origin" "376 -2482 390"
	"angles" "0 0 0"
	"model" "models/props/de_dust/du_crate_64x64_stone.mdl"
	"spawnflags" "0"
	"solid" "6"
	"renderamt" "0"
	"rendercolor" "0 0 0"
	"rendermode" "10"
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "DelayOfficeClip"
	"disableflashlight" "1"
	"disablereceiveshadows" "1"
	"disableshadowdepth" "1"
	"disableshadows" "1"
	"origin" "376 -2562 390"
	"angles" "0 0 0"
	"model" "models/props/de_dust/du_crate_64x64_stone.mdl"
	"spawnflags" "0"
	"solid" "6"
	"renderamt" "0"
	"rendercolor" "0 0 0"
	"rendermode" "10"
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "DelayOfficeClip"
	"disableflashlight" "1"
	"disablereceiveshadows" "1"
	"disableshadowdepth" "1"
	"disableshadows" "1"
	"origin" "376 -2626 390"
	"angles" "0 0 0"
	"model" "models/props/de_dust/du_crate_64x64_stone.mdl"
	"spawnflags" "0"
	"solid" "6"
	"renderamt" "0"
	"rendercolor" "0 0 0"
	"rendermode" "10"
}

;Cannot exploit 'secret'.
modify:
{
	match:
	{
		"classname" "trigger_push"
		"origin" "3130 -1220 567.5"
	}
	insert:
	{
		"OnStartTouch" "!self,Disable,,15,1"
		"OnStartTouch" "!self,AddOutput,OnStartTouch !activator:SetHealth:-999999:0:-1,15.1,1"
		"OnStartTouch" "!self,Enable,,15.2,1"
	}
}

;collision bug fix
add:
{
	"classname" "func_breakable"
	"disableflashlight" "0"
	"disablereceiveshadows" "0"
	"disableshadowdepth" "0"
	"disableshadows" "0"
	"drawinfastreflection" "0"
	"ExplodeDamage" "0"
	"explodemagnitude" "0"
	"ExplodeRadius" "0"
	"explosion" "0"
	"fademindist" "-1"
	"fadescale" "1"
	"gibdir" "0 0 0"
	"health" "0"
	"material" "9"
	"minhealthdmg" "0"
	"nodamageforces" "0"
	"origin" "425.66 2644 548"
	"parentname" "helitrain"
	"PerformanceMode" "0"
	"physdamagescale" "1.0"
	"pressuredelay" "0"
	"propdata" "0"
	"renderamt" "255"
	"rendercolor" "255 255 255"
	"renderfx" "0"
	"rendermode" "10"
	"shadowdepthnocache" "0"
	"spawnflags" "1"
	"spawnobject" "0"
	"targetname" "Collision"
	"model" "*153"
}

modify:
{
	match:
	{
		"classname" "point_template"
		"targetname" "HelicopterTemplate"
	}
	insert:
	{
		"Template11" "Collision"
	}
}