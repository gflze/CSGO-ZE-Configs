; - - - - - - - - - - - - - - - - - - - - - - - 
; 				  ze Last Man Standing
; 				 Map version p3 (CS:GO)
; - - - - - - - - - - - - - - - - - - - - - - -
;start at extreme
modify:
{
	match:
	{
		"classname" "info_target"
		"targetname" "worldspawn_brush_target"
	}
	insert:
	{
		"OnUser1" "worldspawn_brushFireUser10.04-1"
		"OnUser1" "worldspawn_brushAddOutputOnUser1 Level_Counter:SetValue:0:0:10.06-1"
		"OnUser1" "Mode_Extreme_CompareCompare0.06-1"
	}
}

; - - - - - - - - - - - - - - - - - - - - - - -
; Random authors/Hichatu fixes
; - - - - - - - - - - - - - - - - - - - - - - -

;Fix possible skip with tank on Stage 4
add:
{
    "classname" "func_brush"
    "origin" "3640 972 3467"
    "model" "*142"
    "rendermode" "10"
}
;fix stage1 skip after bridge
;stage_1_wall_way2
add:
{
    "classname" "func_brush"
    "origin" "5176 -9963.06 -12740"
    "model" "*675"
    "rendermode" "10"
}

;fix portal gun repeatedly teleporting bug
modify:
{
	match:
	{
		"targetname" "Weapon_PortalGun_Portal_1_Phys"
		"classname" "func_physbox_multiplayer"
	}
	insert:
	{
		"OnUser1" "Weapon_PortalGun_Portal_1_TriggerKill0-1"
		"OnUser2" "Weapon_PortalGun_Portal_1_TriggerClearParent1.5-1"
	}
}
modify:
{
	match:
	{
		"targetname" "Weapon_PortalGun_Portal_2_Phys"
		"classname" "func_physbox_multiplayer"
	}
	insert:
	{
		"OnUser1" "Weapon_PortalGun_Portal_2_TriggerKill0-1"
		"OnUser2" "Weapon_PortalGun_Portal_2_TriggerClearParent1.5-1"
	}
}
add:
{
	"model" "*86"
	"wait" "1"
	"targetname" "Weapon_PortalGun_Portal_1_Trigger"
	"StartDisabled" "1"
	"spawnflags" "1"
	"parentname" "Weapon_PortalGun_Portal_1_Teleport"
	"origin" "-1088 13304 -8516"
	"classname" "trigger_multiple"
	"filtername" "Weapon_PortalGun_FixFilter_2"
	"OnStartTouch" "!activatorAddContextplayer_portal_1:10-1"
	"OnStartTouch" "Weapon_PortalGun_EnterPortalSoundFireUser10-1"
}
add:
{
	"model" "*89"
	"wait" "1"
	"targetname" "Weapon_PortalGun_Portal_2_Trigger"
	"StartDisabled" "1"
	"spawnflags" "1"
	"parentname" "Weapon_PortalGun_Portal_2_Teleport"
	"origin" "-1088 13352 -8516"
	"classname" "trigger_multiple"
	"filtername" "Weapon_PortalGun_FixFilter_1"
	"OnStartTouch" "!activatorAddContextplayer_portal_2:10-1"
	"OnStartTouch" "Weapon_PortalGun_EnterPortalSoundFireUser10-1"
}
add:
{
	"targetname" "Weapon_PortalGun_FixFilter_1_2"
	"ResponseContext" "player_portal_1"
	"Negated" "0"
	"classname" "filter_activator_context"
}
add:
{
	"targetname" "Weapon_PortalGun_FixFilter_2_2"
	"ResponseContext" "player_portal_2"
	"Negated" "0"
	"classname" "filter_activator_context"
}
modify:
{
	match:
	{
		"targetname" "Weapon_PortalGun_Portal_1_Teleport"
		"classname" "trigger_teleport"
	}
	delete:
	{
		"OnEndTouch" "Weapon_PortalGun_EnterPortalSoundFireUser10-1"
		"OnStartTouch" "!activatorAddContextplayer_portal_1:10-1"
		"OnEndTouch" "!activatorRemoveContextplayer_portal_20-1"
	}
	replace:
	{
		"filtername" "Weapon_PortalGun_FixFilter_1_2"
	}
}
modify:
{
	match:
	{
		"targetname" "Weapon_PortalGun_Portal_2_Teleport"
		"classname" "trigger_teleport"
	}
	delete:
	{
		"OnEndTouch" "Weapon_PortalGun_EnterPortalSoundFireUser10-1"
		"OnEndTouch" "!activatorRemoveContextplayer_portal_10-1"
		"OnStartTouch" "!activatorAddContextplayer_portal_2:10-1"
	}
	replace:
	{
		"filtername" "Weapon_PortalGun_FixFilter_2_2"
	}
}

;fix early triggering nuke on stage 4
modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_4_part_5_trigger"
	}
	insert:
	{
		"OnStartTouch" "stage_4_trigger_end,Enable,20,-1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_4_trigger_end"
	}
	replace:
	{
		"StartDisabled" "1"
	}
}


; - - - - - - - - - - - - - - - - - - - - - - -
; 	Changes done by iszaar
; - - - - - - - - - - - - - - - - - - - - - - -
; open doors to prevent ZMs being locked out on Solo ending
modify: 
{
    match:
    {
        "classname" "logic_relay"
        "targetname" "stage_5_core_destroyed"
    }
    insert:
    {
        "OnTrigger" "stage_5_top_door_*Open01"
    }
}
;make ultralisk come faster on event hes not killed
modify: 
{
    match:
    {
		"targetname" "stage5_things"
		"classname" "point_template"
    }
    delete:
    {
        "OnEntitySpawned" "stage_5_lower_ultraliskTrigger120-1"
    }
	insert:
	{
		"OnEntitySpawned" "stage_5_lower_ultraliskTrigger100-1"
	}
}
; Fix stage 2 last vent entrance being breakable early.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_2_teleport_2"
	}
	insert:
	{
		"OnStartTouch" "stage_2_escape_ventSetHealth10051"
	}
}

modify:
{
	match:
	{
		"classname" "func_breakable"
		"targetname" "stage_2_escape_vent"
	}
	replace:
	{
		"health" "0"
	}
}

; Avoid delay on stage 5
modify:
{
	match:
	{
		"classname" "math_counter"
		"targetname" "stage_5_lower_counter_energy"
	}
	insert:
	{
		"OnHitMax" "stage5_antidelayTrigger01"
	}
}

modify:
{
	match:
	{
		"classname" "filter_activator_team"
		"targetname" "stage_5_button_filter"
	}
	insert:
	{
		"OnPass" "stage5_antidelayCancelPending01"
	}
}

add:
{
	"classname" "logic_relay"
	"spawnflags" "0"
	"StartDisabled" "0"
	"targetname" "stage5_antidelay"
	"OnTrigger" "Global_GameText_AnnouncementFireUser361"
	"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage ** ACTIVATE THE ELEVATOR QUICKLY! (1/3) **61"
	"OnTrigger" "Global_GameText_AnnouncementFireUser3161"
	"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage ** ACTIVATE THE ELEVATOR QUICKLY! (2/3) **161"
	"OnTrigger" "Global_GameText_AnnouncementFireUser3261"
	"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage ** LAST WARNING! ACTIVATE THE ELEVATOR QUICKLY! (3/3) **261"
	"OnTrigger" "map1roundend1EndRound_TerroristsWin7361"
}

add:
{
	"classname" "game_round_end"
	"targetname" "map1roundend1"
	"OnRoundEnded" "map1roundend1,Kill,,,1"
}

; Fix zms able to surf and stop stage 2 from being completed (only really doable with high AA but just incase)
add:
{
	"targetname" "team_filter_stage2water_human"
	"filterteam" "3"
	"classname" "filter_activator_team"
}

modify:
{
	match:
	{
		"targetname" "stage_2_hurt_water"
	}
	replace:
	{
		"filtername" "team_filter_stage2water_human"
	}
}
modify:
{
	match:
	{
		"targetname" "stage_2_end_trigger"
	}
	insert:
	{
		"OnStartTouch" "team_filter_stage2water_humanKill01"
		"OnStartTouch" "stage_2_hurt_waterAddOutputdamage 500001"
		"OnStartTouch" "stage_2_hurt_waterAddOutputdamagecap 500001"
	}
}

; make this unblockable (players can get stuck but at least this wont be griefable)
modify:
{
	match:
	{
		"targetname" "stage_x_reward_vehicle_with_weapons"
		"classname" "func_tracktrain"
	}
	replace:
	{
		"dmg" "5"
	}
}

; stage 5 lower delay on the buttons on top
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_5_end_button_blue"
	}
	replace:
	{
		"wait" "0.1"
	}
}

modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_5_end_button_red"
	}
	replace:
	{
		"wait" "0.1"
	}
}

; Stage 4 Nuke breaking will now not cause map to be in limbo (avoid delay) hopefully too incase it for some reason breaks
; This will also fix the issues resulting of stage 4 being extremely open which let predator, freezer and jumper to trigger the round end button since whoever touched this map before decided that was a good idea
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_end_button_protection"
	}
	insert:
	{
		"OnDamaged" "stage4_nuke_brokeEnable01"
	}
}
modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_ultralistk_path_8"
	}
	insert:
	{
		"OnPass" "stage4_nuke_brokeTrigger01"
	}
}

add:
{
	"classname" "logic_relay"
	"spawnflags" "1"
	"StartDisabled" "1"
	"targetname" "stage4_nuke_broke"
	"OnTrigger" "stage_nuke_inmuzer1Enable101"
	"OnTrigger" "stage_nuke_inmuzer2Enable101"
	"OnTrigger" "stage_nuke_inmuzer1Disable10.031"
	"OnTrigger" "stage_nuke_inmuzer2Disable10.031"
	"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage ** THE NUKE FAILED! **21"
	"OnTrigger" "Global_GameText_AnnouncementFireUser331"
	"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage ** THE ULTRALISK IS STILL ALIVE HOPE WE DONT HAVE TO MEET HIM AGAIN... **81"
	"OnTrigger" "Global_GameText_AnnouncementFireUser391"
	"OnTrigger" "Fix_IssueForceSpawn10.51"
}

; nerf antlion
; this was done due to it being OP as fck if you know what to do
modify:
{
	match:
	{
		"classname" "logic_compare"
		"targetname" "Zombie_Item_Antlion_Dig_Relay"
	}
	delete:
	{
		"OnEqualTo" "Global_SpeedModifySpeed1.151.25-1"
	}
	insert:
	{
		"OnEqualTo" "Global_SpeedModifySpeed0.51.25-1"
	}
}

; move vortigaunt stage 1 to let you get past a lot easier with tank
modify:
{
	match:
	{
		"targetname" "Extreme_stage_1"
		"classname" "logic_relay"
		"hammerid" "7668954"
	}
	delete:
	{
		"OnTrigger" "Zombie_Item_Vortigaunt_TemplateAddOutputorigin 7886 2884 -136620-1"
	}
	insert:
	{
		"OnTrigger" "Zombie_Item_Vortigaunt_TemplateAddOutputorigin 7886 3108 -136620-1"
	}
}	

; fix boost on stage 5 with core
modify:
{
	match:
	{
		"targetname" "stage_5_core_hit_push"
		"classname" "trigger_teleport"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector());0-1"
	}
}

; OPTIONAL REMOVE SPEED FOR ZMS AS THEY TP TO AVOID HAVING INCIDENTS WHERE ZMS FALL FASTER THAN THE HUMAN DUE TO SOURCE ENGINE PHYSICS
modify:
{
	match:
	{
		"targetname" "stage_5_last_man_trigger_core_end"
		"classname" "trigger_multiple"
	}
	insert:
	{
		"OnStartTouch" "!activatorRunScriptCodeself.SetVelocity(Vector());0-1"
	}
}	

; fix the british guy adding some skybox making heli shit itself
modify:
{
	match:
	{
		"classname" "path_track"
		"targetname" "stage_x_end_helicopter_track_7"
	}
	replace:
	{
		"origin" "-5952 -9235 5256"
	}
}

; Stage 3 Make zombies unable to survive and delay untill zms are slayed
modify:
{
	match:
	{
		"hammerid" "5643492"
		"targetname" "stage_nuke_inmuzer1"
	}
	insert:
	{
		"filtername" "team_filter_humans"
	}
}

; move tank stage 2 to the v6_1 one
modify:
{
	match:
	{
		"targetname" "Zombie_Item_Tank_Spawner"
		"classname" "env_entity_maker"
	}
	replace:
	{
		"origin" "4848 -10200 -7248"
	}
}


; - - - - - - - - - - - - - - - - - - - - - - -
;	Berke fixes
; - - - - - - - - - - - - - - - - - - - - - - -

; Fix spawn trigger not resetting players.
filter:
{
	"classname" "trigger_multiple"
	"targetname" "teleporter_main_trigger_positioner"
}

modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "teleporter_main_trigger_positioner"
	}
	insert:
	{
		"OnStartTouch" "stage_end_explosion_working,Trigger,,540,1"
		"OnStartTouch" "Z_Items_Filter,TestActivator,,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "filter_multi"
		"targetname" "Z_Items_Filter"
	}
	insert:
	{
		"OnPass" "!activator,AddOutput,targetname ,,-1"
		"OnPass" "!activator,AddOutput,gravity 1,,-1"
		"OnPass" "!activator,AddOutput,OnUser3 !self:AddOutput:health 1200::1,.01,-1"
		"OnPass" "!activator,AddOutput,rendermode 0,,-1"
		"OnPass" "!activator,AddOutput,renderfx 0,,-1"
		"OnPass" "!activator,SetDamageFilter,,,-1"
		"OnPass" "!activator,ClearContext,,,-1"
		"OnPass" "teleporter_main_counter,Add,1,,-1"
		"OnPass" "Global_Speed_suppress,ModifySpeed,1,,-1"
		"OnPass" "stage_5_top_teleport_counter,Add,1,,-1"
		"OnUser1" "!activator,AddOutput,OnUser3 !self:AddOutput:health 10000::1,,-1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "/Extreme_Stage_[1-4]/"
	}
	delete:
	{
		"OnTrigger" "teleporter_main_trigger_positionerAddOutputOnStartTouch !self:FireUser1::0:00-1"
	}
	insert:
	{
		"OnTrigger" "Z_Items_Filter,AddOutput,OnPass !self:FireUser1:::-1,,1"
	}
}

; Remove the message related to checkpoints in warmup round since this version doesn't have them.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Stage_Start_Stage_Warmup"
	}
	delete:
	{
		"OnTrigger" "Global_GameText_AnnouncementAddOutputmessage CHECKPOINT REACHED MEANS STAGE WONT REPEAT WHEN IT ENDS5-1"
	}
}

; Add props to get out of a stuck spot near tank spawn on extreme stage 1.
add:
{
	"classname" "prop_dynamic"
	"targetname" "stage_1_stuff1"
	"origin" "2368 320 -13680"
	"angles" "0 -15 0"
	"model" "models/props/props_crates/wooden_crate_64x64.mdl"
	"solid" "6"
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "stage_1_stuff1"
	"origin" "2368 320 -13608"
	"model" "models/props/props_crates/wooden_crate_64x64.mdl"
	"solid" "6"
}

add:
{
	"classname" "prop_dynamic"
	"targetname" "stage_1_stuff1"
	"origin" "2384 224 -13680"
	"angles" "-10 0 0"
	"model" "models/props/de_nuke/crate_large.mdl"
	"solid" "6"
}

; Add viewcontrol template related outputs, filter stage 1 "Juggernaut" trigger to humans, reset targetnames and prevent viewmodel from being glitched out.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Auto"
	}
	insert:
	{
		"OnSpawn" "!self,Kill,,.01,1"
		"OnSpawn" "map1viewcontrolpreservedtemplate1,ForceSpawn,,.01,1"
		"OnSpawn" "map1viewcontroltemplate1,Kill,,.01,1"
		"OnSpawn" "worldspawn_brush_target,FireUser2,,,1"
		"OnSpawn" "stage_x_crane_breakableRunScriptCodefunction InputUse() { if (activator.GetTeam() == 3) return true; return false; }1"
		"OnSpawn" "stage_x_crane_crateRunScriptCodefunction InputUse() { if (activator.GetTeam() == 3) return true; return false; }1"
		"OnSpawn" "game_playerdieRunScriptCode_ <- delegate { function _get(strKey) { return strKey; } } : {};1"
		"OnSpawn" "player,AddOutput,targetname ,,1"
		"OnSpawn" "playerRunScriptCodeif (self.GetName() == _.zombie_boss || self.GetName() == _.human_mech) EntFireByHandle(caller, _.FireUser1, ' '.tochar(), 0, self, null);1"
		"OnSpawn" "!selfRunScriptCode_ <- delegate { function _get(strKey) { return strKey; } } : {};1"
		"OnUser1" "Map_End_Camera,RemovePlayer,,,1"
		"OnUser1" "Map_End_Camera,AddPlayer,,,1"
	}
}

; Fix stage 2 last vent entrance being breakable early.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_2_teleport_2"
	}
	insert:
	{
		"OnStartTouch" "stage_2_escape_vent,SetHealth,100,10,1"
	}
}

modify:
{
	match:
	{
		"classname" "func_breakable"
		"targetname" "stage_2_escape_vent"
	}
	replace:
	{
		"health" "0"
	}
}

; Optional: Prevent the "Portal Gun" skip.
;modify:
;{
;	match:
;	{
;		"classname" "func_button"
;		"targetname" "Weapon_PortalGun_UI"
;	}
;	replace:
;	{
;		"origin" "-1004 13248 -8512"
;	}
;}

;modify:
;{
;	match:
;	{
;		"classname" "env_entity_maker"
; 		"targetname" "Weapon_PortalGun_Projectile_Spawner"
;	}
;	replace:
;	{
;		"origin" "-1088 13248 -8520"
;	}
;}

; Fix stage 2 last vent fall breaking despite second room being "Mutator Test".
modify:
{
	match:
	{
		"classname" "logic_case"
		"targetname" "stage_2_open_random_relay"
	}
	insert:
	{
		"OnCase03" "stage_2_end_trigger,AddOutput,OnTrigger stage_2_vent_breakable:Break:::1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_once"
		"targetname" "stage_2_end_trigger"
	}
	delete:
	{
		"OnStartTouch" "stage_2_vent_breakableBreak0-1"
	}
}

; Reduce volume of "Mech" minigun sound.
modify:
{
	match:
	{
		"classname" "ambient_generic"
		"targetname" "Human_Item_Mech_Sound_Minigun"
	}
	replace:
	{
		"health" "3"
	}
}

; Fix stage 4 nuke pit teleport being setup wrong.
modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "stage_4_trigger_pad"
	}
	delete:
	{
		"landmark" "stages_teleport_destination"
	}
	insert:
	{
		"target" "stages_teleport_destination"
	}
}

; Fix stage 4 nuke pad being broken showing the wrong message, being able to be damaged multiple times and not resulting in a round end.
modify:
{
	match:
	{
		"classname" "func_button"
		"targetname" "stage_4_end_button_protection"
	}
	delete:
	{
		"OnDamaged" "Global_GameText_AnnouncementRunScriptCodesetMessage(3)0-1"
	}
	insert:
	{
		"OnDamaged" "!self,Kill,,,1"
		"OnDamaged" "Global_GameText_AnnouncementRunScriptCodesetMessage(33);1"
	}
}

; Fix the new truck model used in stage 5 not covering the side like in the original.
modify:
{
	match:
	{
		"classname" "prop_dynamic_override"
		"targetname" "stage_5_megatrontruck"
	}
	replace:
	{
		"origin" "3904 -3440 12480"
	}
}

; Prevent explosions from triggering repeat killer.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Spawn_Explosion_Logic"
	}
	insert:
	{
		"OnSpawn" "Spawn_Explosion_Damage,AddOutput,classname norepeatkiller1,,1"
		"OnSpawn" "Spawn_Explosion_Damage_All,AddOutput,classname norepeatkiller1,,1"
	}
}

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "Spawn_Explosion_Small_Logic"
	}
	insert:
	{
		"OnSpawn" "Spawn_Explosion_Small_Damage,AddOutput,classname norepeatkiller1,,1"
		"OnSpawn" "Spawn_Explosion_Small_Damage_H,AddOutput,classname norepeatkiller1,,1"
	}
}

; When a zombie tank is broken, don't make it disappear but make it non-solid and darken it.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "_human_item_tank_health_drivver_zombiekill"
	}
	delete:
	{
		"OnTrigger" "v_model1Break0-1"
	}
	insert:
	{
		"OnTrigger" "v_model1,AddOutput,solid 0,,1"
		"OnTrigger" "v_button1,Kill,,,1"
		"OnTrigger" "v_model1,Color,64 64 64,.01,1"
		"OnTrigger" "Tank_Cannon,Color,64 64 64,.01,1"
	}
}

; Prevent camping zombie spawns.
; Add filters that prevent all damage but nuke.
add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nukefilter1"
	"filtername" "Nuke_Kill_Trigger"
}

add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nukefilter2"
	"filtername" "Kill_All_Trigger"
}

add:
{
	"classname" "filter_activator_name"
	"targetname" "map1nukefilter3"
	"filtername" "stage_3_nuke"
}

add:
{
	"classname" "filter_multi"
	"targetname" "map1mainnukefilter1"
	"FilterType" "1"
	"Filter01" "map1nukefilter1"
	"Filter02" "map1nukefilter2"
	"Filter03" "map1nukefilter3"
}

; Stage 1
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "1672 -464 -13632"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "6392 224 -13632"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "12184 -10384 -13632"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_1_stuff1"
	"origin" "3856 -9368 -12848"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Stage 2
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_stuff1"
	"origin" "3920 768 -7376"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_stuff1"
	"origin" "-1048 3656 -7632"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_2_stuff1"
	"origin" "-1296 6048 -8032"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Stage 3
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_stuff1"
	"origin" "-296 6392 -560"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_stuff1"
	"origin" "6640 5224 832"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_3_stuff1"
	"origin" "8000 3880 1216"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Stage 4
add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "5968 7952 3376"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "176 -800 3376"
	"angles" "0 90 0"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "-11072 -10488 3376"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

add:
{
	"classname" "trigger_multiple"
	"targetname" "stage_4_stuff1"
	"origin" "9608 -7704 3376"
	"model" "*584"
	"spawnflags" "1"
	"filtername" "team_filter_zombies"
	"OnStartTouch" "!activator,SetDamageFilter,map1mainnukefilter1,.01,-1"
	"OnEndTouch" "!activator,SetDamageFilter,,.01,-1"
}

; Implement the unused zombie teleport in extreme stage 1.
modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "stage_x_camp_door"
	}
	insert:
	{
		"OnFullyOpen" "stage_positioner_teleport,InValue,11,,1"
	}
}

; Implement the unused zombie teleport in extreme stage 3.
modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "stage_3_tests_relay_1"
	}
	insert:
	{
		"OnTrigger" "stage_positioner_teleport,InValue,32,,1"
	}
}

; Fix viewcontrols being laggy for "Alex Mercer" and "Mech".
; Delete the old system used for viewcontrols.
filter:
{
	"classname" "logic_measure_movement"
	"targetname" "Zombie_Item_Boss_Measure"
}

filter:
{
	"classname" "info_teleport_destination"
	"targetname" "Zombie_Item_Boss_Cam_Pos_2"
}

filter:
{
	"classname" "logic_measure_movement"
	"targetname" "Human_Item_Mech_Measure"
}

filter:
{
	"classname" "info_teleport_destination"
	"targetname" "Human_Item_Mech_Cam_Pos_2"
}

; Add the new system where we spawn the viewcontrols using a preserved template and spawn them parented.
modify:
{
	match:
	{
		"classname" "point_viewcontrol"
		"targetname" "Zombie_Item_Boss_Cam"
	}
	insert:
	{
		"parentname" "Zombie_Item_Boss_Cam_Pos"
	}
}

modify:
{
	match:
	{
		"classname" "point_viewcontrol"
		"targetname" "Human_Item_Mech_Cam"
	}
	insert:
	{
		"parentname" "Human_Item_Mech_Knife"
	}
}

add:
{
	"classname" "point_template"
	"targetname" "map1viewcontroltemplate1"
	"Template01" "Zombie_Item_Boss_Cam"
	"Template02" "Human_Item_Mech_Cam"
}

modify:
{
	match:
	{
		"classname" "info_target"
		"targetname" "worldspawn_brush_target"
	}
	insert:
	{
		"OnUser2" "map1viewcontrolpreservedtemplate1,AddOutput,classname info_ladder,,1"
		"OnUser2" "map1viewcontroltemplate1,AddOutput,targetname map1viewcontrolpreservedtemplate1,,1"
	}
}

; When someone dies, give them empty targetname instead of one called "none" and prevent viewmodel from being glitched out.
modify:
{
	match:
	{
		"classname" "trigger_brush"
		"targetname" "game_playerdie"
	}
	delete:
	{
		"OnUse" "!activatorAddOutputtargetname none0-1"
	}
	insert:
	{
		"OnUse" "!activator,AddOutput,targetname ,,-1"
		"OnUse" "!selfRunScriptCodeif (activator.IsValid() && (activator.GetName() == _.zombie_boss || activator.GetName() == _.human_mech)) EntFireByHandle(self, _.FireUser1, ' '.tochar(), 0, activator, null);-1"
		"OnUser1" "Map_End_Camera,RemovePlayer,,,1"
		"OnUser1" "Map_End_Camera,AddPlayer,,,1"
	}
}

; Make trigger of extreme stage 3 third test room bigger to prevent zombies avoiding it by staying just next to the room.
modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "stage_3_tests_main_5"
	}
	replace:
	{
		"model" "*279"
		"origin" "5025.78 5771.83 968"
	}
}
